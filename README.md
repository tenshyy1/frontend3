# Проект интернет-магазина с GraphQL и WebSocket

Этот проект представляет собой полнофункциональный интернет-магазин с реализацией REST API, GraphQL API и WebSocket для чата в реальном времени между покупателями и администраторами.

## Содержание

- [Структура проекта](#структура-проекта)
- [Функциональность](#функциональность)
- [Технический стек](#технический-стек)
- [Установка](#установка)
- [Запуск](#запуск)
- [API документация](#api-документация)
- [Работа с GraphQL](#работа-с-graphql)
- [Работа с WebSocket чатом](#работа-с-websocket-чатом)
- [Устранение неполадок](#устранение-неполадок)

## Структура проекта

```
Copyshop-project/
├── product-server/            # REST API сервер (порт 3000)
│   ├── index.js               # Основной файл сервера
│   ├── products.json          # JSON-файл с товарами
│   └── package.json           # Зависимости для сервера
│
├── admin-server/              # REST API сервер (порт 8080)
│   ├── index.js               # Основной файл сервера с REST API и Swagger
│   ├── admin.html             # Страница административной панели с чатом
│   └── package.json           # Зависимости для сервера
│
├── graphql-server/            # GraphQL API сервер (порт 4000)
│   ├── index.js               # Основной файл сервера с GraphQL схемой
│   └── package.json           # Зависимости для сервера
│
├── websocket-server/          # WebSocket сервер для чата (порт 5001)
│   ├── index.js               # Основной файл сервера
│   └── package.json           # Зависимости для сервера
│
├── frontend/                  # Клиентская часть
│   └── index.html             # HTML-страница с каталогом товаров и чатом
│
└── README.md                  # Документация проекта
```

## Функциональность

### Клиентская часть (порт динамически определяется при открытии frontend/index.html)

- Каталог товаров с гибкой фильтрацией данных
- Возможность просмотра товаров в разных представлениях (полное, базовое, детальное)
- Чат с администратором в реальном времени

### Административная панель (порт 8080)

- CRUD операции с товарами (создание, чтение, обновление, удаление)
- Swagger документация REST API
- Чат с покупателями в реальном времени

### REST API (порт 8080)

- GET /api/products - получение всех товаров
- GET /api/products/:id - получение товара по ID
- POST /api/products - добавление нового товара
- PUT /api/products/:id - обновление товара
- DELETE /api/products/:id - удаление товара

### GraphQL API (порт 4000)

- Query: products - получение всех товаров с полной информацией
- Query: productsBasicInfo - получение только названия и цены товаров
- Query: productsWithDetails - получение названия и описания товаров
- Query: productsByCategory - фильтрация товаров по категории

### WebSocket API (порт 5001)

- Двусторонний обмен сообщениями между покупателями и администраторами
- Системные уведомления о подключении/отключении пользователей
- Форматирование сообщений с временными метками

## Технический стек

### Серверная часть

- Node.js - серверная среда выполнения JavaScript
- Express.js - фреймворк для разработки веб-приложений
- Apollo Server - сервер для GraphQL API
- ws - реализация WebSocket протокола
- Swagger UI - интерактивная документация API

### Клиентская часть

- HTML/CSS/JavaScript - стандартные веб-технологии
- GraphQL клиент - реализация запросов к GraphQL API
- WebSocket клиент - для связи с чат-сервером

## Установка

### Предварительные требования

- Node.js (версия 14 или выше)
- npm (обычно устанавливается вместе с Node.js)

### Шаги установки

1. Клонируйте репозиторий:
```bash
git clone https://github.com/ваш-аккаунт/shop-project.git
cd shop-project
```

2. Установите зависимости для всех серверов:
```bash
# Для сервера товаров
cd product-server
npm install

# Для административного сервера
cd ../admin-server
npm install

# Для GraphQL сервера
cd ../graphql-server
npm install

# Для WebSocket сервера
cd ../websocket-server
npm install
```

## Запуск

Для полноценной работы необходимо запустить все четыре сервера в разных терминалах:

1. Запустите сервер товаров (REST API):
```bash
cd product-server
node index.js
```
Сервер будет доступен по адресу: http://localhost:3000

2. Запустите административный сервер:
```bash
cd admin-server
node index.js
```
Административная панель будет доступна по адресу: http://localhost:8080  
Swagger документация: http://localhost:8080/api-docs

3. Запустите GraphQL сервер:
```bash
cd graphql-server
node index.js
```
GraphQL Playground будет доступен по адресу: http://localhost:4000/graphql  
Документация GraphQL: http://localhost:4000/

4. Запустите WebSocket сервер:
```bash
cd websocket-server
node index.js
```
Тестовая страница чата будет доступна по адресу: http://localhost:5001/

5. Откройте клиентскую часть в браузере:
   - Откройте файл `frontend/index.html` в браузере
   - Если вы хотите запустить клиентскую часть через HTTP-сервер:
   ```bash
   npx serve frontend
   ```
   И затем откройте URL, указанный в выводе команды (обычно http://localhost:5000).

## API документация

### REST API
Документация REST API доступна через Swagger UI по адресу http://localhost:8080/api-docs. Здесь вы можете просмотреть все доступные эндпоинты, параметры запросов и протестировать API прямо из браузера.

### GraphQL API
Документация GraphQL API доступна по адресу http://localhost:4000/, а интерактивный GraphQL Playground - по адресу http://localhost:4000/graphql.

Основные запросы:

- Получение всех товаров с полной информацией:
```graphql
query {
  products {
    id
    name
    price
    description
    category {
      id
      name
    }
  }
}
```

- Получение только базовой информации о товарах:
```graphql
query {
  productsBasicInfo {
    id
    name
    price
  }
}
```

- Получение товаров с детальным описанием:
```graphql
query {
  productsWithDetails {
    id
    name
    description
    category {
      name
    }
  }
}
```

- Фильтрация товаров по категории:
```graphql
query {
  productsByCategory(categoryId: "1") {
    id
    name
    price
  }
}
```

### WebSocket API
WebSocket API документация доступна по адресу http://localhost:5001/. Здесь вы найдете информацию о формате сообщений и тестовую страницу для проверки функциональности чата.

Формат сообщений:
```json
{
  "type": "message",
  "userType": "customer", // или "admin"
  "userId": "unique-user-id",
  "username": "Имя пользователя",
  "content": "Текст сообщения"
}
```

## Работа с GraphQL

### Использование различных представлений данных
В клиентской части реализованы три типа представления данных:

1. Полное представление - отображает всю информацию о товаре (название, цена, описание, категория)
2. Базовая информация - отображает только название и цену товара
3. Детальное описание - отображает название и подробное описание товара

Для переключения между представлениями используйте соответствующие кнопки в интерфейсе.

### Реализация собственных запросов
Вы можете создавать собственные запросы в GraphQL Playground (http://localhost:4000/graphql) и затем интегрировать их в клиентский код.

Пример создания нового запроса:
```javascript
const query = `
  query {
    productsByCategory(categoryId: "2") {
      id
      name
      price
      description
    }
  }
`;

const result = await fetchGraphQL(query);
// Обработка результата
```

## Работа с WebSocket чатом

### Подключение к чату
В клиентской части и в административной панели предусмотрены кнопки "Подключиться к чату". При нажатии на них происходит подключение к WebSocket серверу.

### Обмен сообщениями
После подключения вы можете отправлять и получать сообщения в реальном времени. Сообщения сортируются по типу пользователя и отображаются с соответствующим форматированием.

### Обработка ошибок и переподключение
Система автоматически обрабатывает возможные ошибки подключения и отображает соответствующие уведомления. При потере соединения можно переподключиться, нажав кнопку повторно.

## Устранение неполадок

### Сервер не запускается
- Проверьте, что порт не занят другим приложением
- Убедитесь, что все зависимости установлены
- Проверьте наличие всех необходимых файлов

### Ошибки при загрузке товаров
- Убедитесь, что файл products.json существует и содержит корректные данные
- Проверьте работоспособность GraphQL сервера
- Просмотрите ошибки в консоли браузера

### Проблемы с чатом
- Убедитесь, что WebSocket сервер запущен на порту 5001
- Проверьте URL для подключения к WebSocket в клиентском коде
- Просмотрите ошибки в консоли браузера и сервера

### Проблемы с CORS
Если возникают ошибки CORS, убедитесь, что для всех серверов включен CORS middleware:
```javascript
app.use(cors());
```

При необходимости настройте конкретные домены:
```javascript
app.use(cors({
  origin: ['http://localhost:3000', 'http://localhost:8080']
}));
```